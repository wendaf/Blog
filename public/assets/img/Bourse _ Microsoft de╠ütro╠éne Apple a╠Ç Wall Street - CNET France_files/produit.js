var selected_sentiment=null,sentiment_types={"i-have":"0","i-want":"1","no-thanks":"2"};$(document).ready(function(){produit.trackIt(),produit.initSentiment()});var produit={displayLightbox:function(e,t){e.length>0&&$.colorbox({href:e,data:t,initialHeight:30,initialWidth:30,overlayClose:!1})},closeLightbox:function(){$.colorbox.close()},trackIt:function(){$("#i-have, #i-want, #no-thanks").click(function(){var e=$(this).attr("id"),t=$("#sentiment-tracker ul").attr("id"),s=$("#"+t).attr("id").split("_")[1];if(null==selected_sentiment)produit.createTracking(e,t);else if(selected_sentiment!=e){var n="/sentiment/show-response/?response=change-tracking&new_type="+e+"&old_type="+selected_sentiment+"&product_id="+s;produit.displayLightbox(n)}else produit.displayLightbox("/sentiment/show-response/?response=already-tracked")})},createTracking:function(e,t){var s=$("#"+t).attr("id").split("_")[1];$.ajax({type:"post",url:"/sentiment/track-it/",data:{product_id:s,type:e},dataType:"json",async:!1,cache:!1,success:function(t){!0===t.success?"tracked"==t.response_code&&($("#"+e).find("span.count").html(t.count),produit.selectSentiment(e),produit.displayLightbox("/sentiment/show-response/?response="+t.response_code+"&product_id="+s)):produit.displayLightbox("/sentiment/show-response/?response="+t.response_code)},error:function(e){produit.displayLightbox("/sentiment/show-response/?response=error")}})},changeTracking:function(e){var t=$("#sentiment-tracker ul").attr("id"),s=$("#"+t).attr("id").split("_")[1];$.ajax({type:"post",url:"/sentiment/change-tracking/",data:{product_id:s,type:e},dataType:"json",async:!1,cache:!1,success:function(t){!0===t.success?($("#"+t.new_type).find("span.count").html(t.new_count),$("#"+t.old_type).find("span.count").html(t.old_count),produit.selectSentiment(e),produit.closeLightbox()):produit.displayLightbox("/sentiment/show-response/?response="+t.response_code)},error:function(e){produit.displayLightbox("/sentiment/show-response/?response=error")}})},leaveComment:function(e){var t=$("#lb_comment").val();$.ajax({type:"post",url:"/sentiment/leave-comment/",data:{product_id:e,comment:t},dataType:"json",async:!1,cache:!1,success:function(e){!0===e.success?produit.closeLightbox():produit.displayLightbox("/sentiment/show-response/?response="+e.response_code)},error:function(e){produit.displayLightbox("/sentiment/show-response/?response=error")}})},initSentiment:function(){for(s in sentiment_types)$("#"+s).find(".social-button-small").hasClass("selected")&&(selected_sentiment=s)},selectSentiment:function(e){for(s in sentiment_types)s==e?($("#"+s).find(".social-button-small").addClass("selected"),selected_sentiment=s):$("#"+s).find(".social-button-small").removeClass("selected")}};